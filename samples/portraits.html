<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Portraits</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="portraits.css">
  </head>
  <body>
    <div id="loading">
      LOADING
    </div>
    <p>This <a href="http://romulusetrem.us/flexo/">Flexo</a> sample shows how
    to load and display images in parallel or in sequence using promises. The
    is by <a href="http://jonathanlarabie.net/">Jonathan Larabie</a> and
      <a href="http://romulusetrem.us/">romulusetrem.us</a>.</p>
    <p id="seq">Here, the images are displayed in sequence, so that the first
    image is always displayed first, even if the other images have finished
    loading before it. Compare with <a href="?seq=false">displaying the images
      in parallel</a>.</p>
    <p id="par">Here, the images are displayed in parallel, so that an image is
    displayed as soon as it is loaded, regardless of load order. Compare with
    <a href="?seq=true">displaying the images in sequence</a>.</p>
    <ul id="gallery">
    </ul>
    <script src="../flexo.js"></script>
    <script>
"use strict";

var URL = "https://dl.dropboxusercontent.com/u/7465599/romulusetrem.us/media/images/randomhead/portraits/%0.png";

var args = flexo.get_args({ n: 46, m: 10, seq: true });
flexo.safe_remove(document.getElementById(args.seq ? "par" : "seq"));
var urn = new flexo.Urn;
for (var i = 0; i < args.n; ++i) {
  urn.add(i + 1);
}
var picks = urn.picks(args.m);

var li = [];
var ul = document.getElementById("gallery");
for (var i = 0; i < args.m; ++i) {
  li.push(ul.appendChild(flexo.$li()));
}

(args.seq ?
  flexo.promise_fold(picks.map(function (n) {
    return flexo.promise_img(URL.fmt(flexo.pad(n, 2)));
  }), function (_, img, i) {
    return img.then(function (img_) {
      li[i].appendChild(img_);
      console.log("Loaded image #%0".fmt(i));
    });
  }) :
  flexo.promise_each(picks.map(function (n, i) {
    return flexo.promise_img(URL.fmt(flexo.pad(n, 2))).then(function (img) {
      li[i].appendChild(img);
      console.log("Loaded image #%0".fmt(i));
    });
  }))
).then(function (images) {
  console.log("All images loaded");
  flexo.safe_remove(document.getElementById("loading"));
});

    </script>
  </body>
</html>
